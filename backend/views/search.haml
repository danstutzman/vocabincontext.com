%html
  %head
    %title Search
  %body
    %h1 Search
    %form(method='post' action='/search')
      %input(type='text' name='query')
      %input(type='submit')
    %hr
      Suggested searches:
      - @term_counts.each do |term_count|
        - term, count = term_count
        %a{:href => "?query=#{term}"}= term
        = "(#{count})"
    %hr

    - if @labeled_excerpts.nil? || @unlabeled_excerpts.nil?
    - elsif @labeled_excerpts.size == 0 && @unlabeled_excerpts.size == 0
      No results for this query.
    - else
      - if @labeled_excerpts.size > 0
        %h2 Labeled excerpts
        %ul
          - @labeled_excerpts.each do |result|
            %li
              %a{ :href => "/song/#{result[:song_id]}#line#{result[:line_num]}" }
                = result[:artist_name]
                = '-'
                = result[:song_name] + ':'
                = "\"#{result[:line]}\""
              %a{ :href => "/split_mp3s/#{result[:youtube_video_id]}.#{result[:start_time]}.#{result[:end_time]}.mp3", :target => '_blank' }
                = "(play #{result[:start_time]} to #{result[:end_time]})"
      - if @unlabeled_excerpts.size > 0
        %h2 Unlabeled excerpts
        %ul
          - @unlabeled_excerpts.each do |result|
            %li
              %a{ :href => "/song/#{result[:song_id]}#line#{result[:line_num]}" }
                = result[:artist_name]
                = '-'
                = result[:song_name] + ':'
                = "\"#{result[:line]}\""

      %hr
    %a{ :href => "/search?query=#{params['query']}&offset=#{params['offset'].to_i + FerretSearch::MAX_NUM_EXCERPTS_TO_RETURN}" }
      Next page
    != haml :_js
    != haml :_loading
    :javascript
      require(["cs!app/app"], function(main) { main.setupFromRequestParams(); });
