/**
 * almond 0.1.4 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license
 *
 * SoundManager 2: JavaScript Sound for the Web
 * ----------------------------------------------
 * http://schillmania.com/projects/soundmanager2/
 *
 * Copyright (c) 2007, Scott Schiller. All rights reserved.
 * Code provided under the BSD License:
 * http://schillmania.com/projects/soundmanager2/license.txt
 *
 * V2.97a.20120513
 */

// hat tip: Flash Detect library (BSD, (C) 2007) by Carl "DocYes" S. Yestrau - http://featureblend.com/javascript-flash-detection-library.html / http://featureblend.com/license.txt

var requirejs,require,define;(function(e){function a(e,t){var n,r,i,o,u,a,f,l,c,h,p=t&&t.split("/"),d=s.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){o=i,u=l;break}}}if(o)break;!a&&v&&v[r]&&(a=v[r],f=l)}!o&&a&&(o=a,u=f),o&&(n.splice(0,u,o),e=n.join("/"))}return e}function f(t,r){return function(){return n.apply(e,u.call(arguments,0).concat([t,r]))}}function l(e){return function(t){return a(t,e)}}function c(e){return function(t){r[e]=t}}function h(n){if(i.hasOwnProperty(n)){var s=i[n];delete i[n],o[n]=!0,t.apply(e,s)}if(!r.hasOwnProperty(n))throw new Error("No "+n);return r[n]}function p(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=a(e.slice(0,i),t),e=e.slice(i+1),r=h(n),r&&r.normalize?e=r.normalize(e,l(t)):e=a(e,t)):e=a(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function d(e){return function(){return s&&s.config&&s.config[e]||{}}}var t,n,r={},i={},s={},o={},u=[].slice;t=function(t,n,s,u){var a,l,v,m,g,y=[],b;u=u||t;if(typeof s=="function"){n=!n.length&&s.length?["require","exports","module"]:n;for(g=0;g<n.length;g+=1){m=p(n[g],u),l=m.f;if(l==="require")y[g]=f(t);else if(l==="exports")y[g]=r[t]={},b=!0;else if(l==="module")a=y[g]={id:t,uri:"",exports:r[t],config:d(t)};else if(r.hasOwnProperty(l)||i.hasOwnProperty(l))y[g]=h(l);else if(m.p)m.p.load(m.n,f(u,!0),c(l),{}),y[g]=r[l];else if(!o[l])throw new Error(t+" missing "+l)}v=s.apply(r[t],y);if(t)if(a&&a.exports!==e&&a.exports!==r[t])r[t]=a.exports;else if(v!==e||!b)r[t]=v}else t&&(r[t]=s)},requirejs=require=n=function(r,i,o,u,a){return typeof r=="string"?h(p(r,i).f):(r.splice||(s=r,i.splice?(r=i,i=o,o=null):r=e),i=i||function(){},typeof o=="function"&&(o=u,u=a),u?t(e,r,i,o):setTimeout(function(){t(e,r,i,o)},15),n)},n.config=function(e){return s=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),i[e]=[e,t,n]},define.amd={jQuery:!0}})(),define("almond",[],function(){}),define("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){define("cs!app/fakeSoundManager",["require","jquery"],function(e){var t,n,r,i;return t=e("jquery"),n=function(){function e(e){this.params=e}return e.prototype.play=function(){var e,t,n;this.duration=6e3,this.peakData={left:0,right:0},n=[];for(e=t=0;t<6e3;e=t+=500)this.position=e,n.push(this.params.whileplaying());return n},e.prototype.pause=function(){return null},e}(),r=function(){function e(){}return e.prototype.onready=function(e){return t(e)},e.prototype.createSound=function(e){return new n(e)},e}(),i=new r,i})}.call(this),function(e){function n(t,n){function Gt(e){return function(t){var n=this._t,r;return!n||!n._a?(n&&n.sID?i._wD(a+"ignoring "+t.type+": "+n.sID):i._wD(a+"ignoring "+t.type),r=null):r=e.call(this,t),r}}this.flashVersion=8,this.debugMode=!0,this.debugFlash=!1,this.useConsole=!0,this.consoleOnly=!0,this.waitForWindowLoad=!1,this.bgColor="#ffffff",this.useHighPerformance=!1,this.flashPollingInterval=null,this.html5PollingInterval=null,this.flashLoadTimeout=1e3,this.wmode=null,this.allowScriptAccess="always",this.useFlashBlock=!1,this.useHTML5Audio=!0,this.html5Test=/^(probably|maybe)$/i,this.preferFlash=!0,this.noSWFCache=!1,this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.movieID="sm2-container",this.id=n||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20120513",this.version=null,this.movieURL=null,this.url=t||null,this.altURL=null,this.swfLoaded=!1,this.enabled=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.didFlashBlock=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null},this.hasHTML5=function(){try{return typeof Audio!="undefined"&&typeof (new Audio).canPlayType!="undefined"}catch(e){return!1}}(),this.html5={usingFlash:null},this.flash={},this.html5Only=!1,this.ignoreFlash=!1;var r,i=this,s=null,o="soundManager",u=o+"::",a="HTML5::",f,l=navigator.userAgent,c=e,h=c.location.href.toString(),p=document,d,v,m,g=[],y=!0,b,w=!1,E=!1,S=!1,x=!1,T=!1,N,C=0,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V=["log","info","warn","error"],$=8,J,K,Q,G=null,Y=null,Z,et,tt,nt,rt,it,st,ot,ut,at=!1,ft=!1,lt,ct,ht,pt=0,dt=null,vt,mt=null,gt,yt,bt,wt,Et,St,xt,Tt,Nt=Array.prototype.slice,Ct=!1,kt,Lt,At,Ot,Mt,_t=l.match(/(ipad|iphone|ipod)/i),Dt=l.match(/firefox/i),Pt=l.match(/msie/i),Ht=l.match(/webkit/i),Bt=l.match(/safari/i)&&!l.match(/chrome/i),jt=l.match(/opera/i),Ft=l.match(/(mobile|pre\/|xoom)/i)||_t,It=!h.match(/usehtml5audio/i)&&!h.match(/sm2\-ignorebadua/i)&&Bt&&!l.match(/silk/i)&&l.match(/OS X 10_6_([3-7])/i),qt=typeof console!="undefined"&&typeof console.log!="undefined",Rt=typeof p.hasFocus!="undefined"?p.hasFocus():null,Ut=Bt&&typeof p.hasFocus=="undefined",zt=!Ut,Wt=/(mp3|mp4|mpa)/i,Xt="about:blank",Vt=p.location?p.location.protocol.match(/http/i):null,$t=Vt?"":"http://",Jt=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|mp4v|3gp|3g2)\s*(?:$|;)/i,Kt=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","mp4v","3gp","3g2"],Qt=new RegExp("\\.("+Kt.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!Vt,this._global_a=null,nt={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},Ft&&(i.useHTML5Audio=!0,i.preferFlash=!1,_t&&(i.ignoreFlash=!0,Ct=!0)),this.ok=function(){return mt?S&&!x:i.useHTML5Audio&&i.hasHTML5},this.supported=this.ok,this.getMovie=function(e){return f(e)||p[e]||c[e]},this.createSound=function(e,t){function c(){return a=it(a),i.sounds[l.id]=new r(l),i.soundIDs.push(l.id),i.sounds[l.id]}var n,u,a=null,f=null,l=null;return n=o+".createSound(): ",u=n+Z(S?"notOK":"notReady"),!S||!i.ok()?(ot(u),!1):(typeof t!="undefined"&&(e={id:e,url:t}),a=L(e),a.url=vt(a.url),l=a,l.id.toString().charAt(0).match(/^[0-9]$/)&&i._wD(n+Z("badID",l.id),2),i._wD(n+l.id+" ("+l.url+")",1),ut(l.id,!0)?(i._wD(n+l.id+" exists",1),i.sounds[l.id]):(yt(l)?(f=c(),i._wD("Loading sound "+l.id+" via HTML5"),f._setup_html5(l)):(m>8&&(l.isMovieStar===null&&(l.isMovieStar=l.serverURL||(l.type?l.type.match(Jt):!1)||l.url.match(Qt)),l.isMovieStar&&(i._wD(n+"using MovieStar handling"),l.loops>1&&N("noNSLoop"))),l=st(l,n),f=c(),m===8?s._createSound(l.id,l.loops||1,l.usePolicyFile):(s._createSound(l.id,l.url,l.usePeakData,l.useWaveformData,l.useEQData,l.isMovieStar,l.isMovieStar?l.bufferTime:!1,l.loops||1,l.serverURL,l.duration||null,l.autoPlay,!0,l.autoLoad,l.usePolicyFile),l.serverURL||(f.connected=!0,l.onconnect&&l.onconnect.apply(f))),!l.serverURL&&(l.autoLoad||l.autoPlay)&&f.load(l)),!l.serverURL&&l.autoPlay&&f.play(),f))},this.destroySound=function(e,t){if(!ut(e))return!1;var n=i.sounds[e],r;n._iO={},n.stop(),n.unload();for(r=0;r<i.soundIDs.length;r++)if(i.soundIDs[r]===e){i.soundIDs.splice(r,1);break}return t||n.destruct(!0),n=null,delete i.sounds[e],!0},this.load=function(e,t){return ut(e)?i.sounds[e].load(t):!1},this.unload=function(e){return ut(e)?i.sounds[e].unload():!1},this.onPosition=function(e,t,n,r){return ut(e)?i.sounds[e].onposition(t,n,r):!1},this.onposition=this.onPosition,this.clearOnPosition=function(e,t,n){return ut(e)?i.sounds[e].clearOnPosition(t,n):!1},this.play=function(e,t){var n=!1;return!S||!i.ok()?(ot(o+".play(): "+Z(S?"notOK":"notReady")),n):ut(e)?i.sounds[e].play(t):(t instanceof Object||(t={url:t}),t&&t.url&&(i._wD(o+'.play(): attempting to create "'+e+'"',1),t.id=e,n=i.createSound(t).play()),n)},this.start=this.play,this.setPosition=function(e,t){return ut(e)?i.sounds[e].setPosition(t):!1},this.stop=function(e){return ut(e)?(i._wD(o+".stop("+e+")",1),i.sounds[e].stop()):!1},this.stopAll=function(){var e;i._wD(o+".stopAll()",1);for(e in i.sounds)i.sounds.hasOwnProperty(e)&&i.sounds[e].stop()},this.pause=function(e){return ut(e)?i.sounds[e].pause():!1},this.pauseAll=function(){var e;for(e=i.soundIDs.length-1;e>=0;e--)i.sounds[i.soundIDs[e]].pause()},this.resume=function(e){return ut(e)?i.sounds[e].resume():!1},this.resumeAll=function(){var e;for(e=i.soundIDs.length-1;e>=0;e--)i.sounds[i.soundIDs[e]].resume()},this.togglePause=function(e){return ut(e)?i.sounds[e].togglePause():!1},this.setPan=function(e,t){return ut(e)?i.sounds[e].setPan(t):!1},this.setVolume=function(e,t){return ut(e)?i.sounds[e].setVolume(t):!1},this.mute=function(e){var t=0;typeof e!="string"&&(e=null);if(!e){i._wD(o+".mute(): Muting all sounds");for(t=i.soundIDs.length-1;t>=0;t--)i.sounds[i.soundIDs[t]].mute();return i.muted=!0,!0}return ut(e)?(i._wD(o+'.mute(): Muting "'+e+'"'),i.sounds[e].mute()):!1},this.muteAll=function(){i.mute()},this.unmute=function(e){var t;typeof e!="string"&&(e=null);if(!e){i._wD(o+".unmute(): Unmuting all sounds");for(t=i.soundIDs.length-1;t>=0;t--)i.sounds[i.soundIDs[t]].unmute();return i.muted=!1,!0}return ut(e)?(i._wD(o+'.unmute(): Unmuting "'+e+'"'),i.sounds[e].unmute()):!1},this.unmuteAll=function(){i.unmute()},this.toggleMute=function(e){return ut(e)?i.sounds[e].toggleMute():!1},this.getMemoryUse=function(){var e=0;return s&&m!==8&&(e=parseInt(s._getMemoryUse(),10)),e},this.disable=function(e){var t;typeof e=="undefined"&&(e=!1);if(x)return!1;x=!0,N("shutdown",1);for(t=i.soundIDs.length-1;t>=0;t--)J(i.sounds[i.soundIDs[t]]);return k(e),Tt.remove(c,"load",M),!0},this.canPlayMIME=function(e){var t;return i.hasHTML5&&(t=bt({type:e})),!t&&mt&&(t=e&&i.ok()?!!((m>8?e.match(Jt):null)||e.match(i.mimePattern)):null),t},this.canPlayURL=function(e){var t;return i.hasHTML5&&(t=bt({url:e})),!t&&mt&&(t=e&&i.ok()?!!e.match(i.filePattern):null),t},this.canPlayLink=function(e){return typeof e.type!="undefined"&&e.type&&i.canPlayMIME(e.type)?!0:i.canPlayURL(e.href)},this.getSoundById=function(e,t){if(!e)throw new Error(o+".getSoundById(): sID is null/undefined");var n=i.sounds[e];return!n&&!t&&i._wD('"'+e+'" is an invalid sound ID.',2),n},this.onready=function(e,t){var n="onready",r=!1;if(!(e&&e instanceof Function))throw Z("needFunction",n);return S&&i._wD(Z("queue",n)),t||(t=c),A(n,e,t),O(),r=!0,r},this.ontimeout=function(e,t){var n="ontimeout",r=!1;if(!(e&&e instanceof Function))throw Z("needFunction",n);return S&&i._wD(Z("queue",n)),t||(t=c),A(n,e,t),O({type:n}),r=!0,r},this._writeDebug=function(e,t,n){var r="soundmanager-debug",s,o,u;if(!i.debugMode)return!1;typeof n!="undefined"&&n&&(e=e+" | "+(new Date).getTime());if(qt&&i.useConsole){u=V[t],typeof console[u]!="undefined"?console[u](e):console.log(e);if(i.consoleOnly)return!0}try{s=f(r);if(!s)return!1;o=p.createElement("div"),++C%2===0&&(o.className="sm2-alt"),typeof t=="undefined"?t=0:t=parseInt(t,10),o.appendChild(p.createTextNode(e)),t&&(t>=2&&(o.style.fontWeight="bold"),t===3&&(o.style.color="#ff3333")),s.insertBefore(o,s.firstChild)}catch(a){}return s=null,!0},this._wD=this._writeDebug,this._debug=function(){var e,t;N("currentObj",1);for(e=0,t=i.soundIDs.length;e<t;e++)i.sounds[i.soundIDs[e]]._debug()},this.reboot=function(){i._wD(o+".reboot()"),i.soundIDs.length&&i._wD("Destroying "+i.soundIDs.length+" SMSound objects...");var e,t;for(e=i.soundIDs.length-1;e>=0;e--)i.sounds[i.soundIDs[e]].destruct();try{Pt&&(Y=s.innerHTML),G=s.parentNode.removeChild(s),i._wD("Flash movie removed.")}catch(n){N("badRemove",2)}Y=G=mt=null,i.enabled=q=S=at=ft=w=E=x=i.swfLoaded=!1,i.soundIDs=[],i.sounds={},s=null;for(e in g)if(g.hasOwnProperty(e))for(t=g[e].length-1;t>=0;t--)g[e][t].fired=!1;i._wD(o+": Rebooting..."),c.setTimeout(i.beginDelayedInit,20)},this.getMoviePercent=function(){return s&&typeof s.PercentLoaded!="undefined"?s.PercentLoaded():null},this.beginDelayedInit=function(){T=!0,F(),setTimeout(function(){return ft?!1:(U(),j(),ft=!0,!0)},20),_()},this.destruct=function(){i._wD(o+".destruct()"),i.disable(!0)},r=function(e){var t=this,n,r,o,u,f,l,c=!1,h=[],p=0,d,v,g=null,y;y={duration:null,time:null},this.sID=e.id,this.url=e.url,this.options=L(e),this.instanceOptions=this.options,this._iO=this.instanceOptions,this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,this.id3={},this._debug=function(){if(i.debugMode){var e=null,n=[],r,s,o=64;for(e in t.options)t.options[e]!==null&&(t.options[e]instanceof Function?(r=t.options[e].toString(),r=r.replace(/\s\s+/g," "),s=r.indexOf("{"),n.push(" "+e+": {"+r.substr(s+1,Math.min(Math.max(r.indexOf("\n")-1,o),o)).replace(/\n/g,"")+"... }")):n.push(" "+e+": "+t.options[e]));i._wD("SMSound() merged options: {\n"+n.join(", \n")+"\n}")}},this._debug(),this.load=function(e){var n=null,r;typeof e!="undefined"?(t._iO=L(e,t.options),t.instanceOptions=t._iO):(e=t.options,t._iO=e,t.instanceOptions=t._iO,g&&g!==t.url&&(N("manURL"),t._iO.url=t.url,t.url=null)),t._iO.url||(t._iO.url=t.url),t._iO.url=vt(t._iO.url),i._wD("SMSound.load(): "+t._iO.url,1);if(t._iO.url===t.url&&t.readyState!==0&&t.readyState!==2)return N("onURL",1),t.readyState===3&&t._iO.onload&&t._iO.onload.apply(t,[!!t.duration]),t;r=t._iO,g=t.url,t.loaded=!1,t.readyState=1,t.playState=0;if(yt(r))n=t._setup_html5(r),n._called_load?i._wD(a+"ignoring request to load again: "+t.sID):(i._wD(a+"load: "+t.sID),t._html5_canplay=!1,t._a.autobuffer="auto",t._a.preload="auto",n._called_load=!0,r.autoPlay?t.play():n.load());else try{t.isHTML5=!1,t._iO=st(it(r)),r=t._iO,m===8?s._load(t.sID,r.url,r.stream,r.autoPlay,r.whileloading?1:0,r.loops||1,r.usePolicyFile):s._load(t.sID,r.url,!!r.stream,!!r.autoPlay,r.loops||1,!!r.autoLoad,r.usePolicyFile)}catch(o){N("smError",2),b("onload",!1),z({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}return t},this.unload=function(){return t.readyState!==0&&(i._wD('SMSound.unload(): "'+t.sID+'"'),t.isHTML5?(u(),t._a&&(t._a.pause(),Et(t._a))):m===8?s._unload(t.sID,Xt):s._unload(t.sID),n()),t},this.destruct=function(e){i._wD('SMSound.destruct(): "'+t.sID+'"'),t.isHTML5?(u(),t._a&&(t._a.pause(),Et(t._a),Ct||o(),t._a._t=null,t._a=null)):(t._iO.onfailure=null,s._destroySound(t.sID)),e||i.destroySound(t.sID,!0)},this.play=function(e,n){var r,o,u,a,h,p=null;r="SMSound.play(): ",n=n===undefined?!0:n,e||(e={}),t._iO=L(e,t._iO),t._iO=L(t._iO,t.options),t._iO.url=vt(t._iO.url),t.instanceOptions=t._iO;if(t._iO.serverURL&&!t.connected)return t.getAutoPlay()||(i._wD(r+" Netstream not connected yet - setting autoPlay"),t.setAutoPlay(!0)),t;yt(t._iO)&&(t._setup_html5(t._iO),f()),t.playState===1&&!t.paused&&(o=t._iO.multiShot,o?i._wD(r+'"'+t.sID+'" already playing (multi-shot)',1):(i._wD(r+'"'+t.sID+'" already playing (one-shot)',1),p=t));if(p!==null)return p;t.loaded?i._wD(r+'"'+t.sID+'"'):t.readyState===0?(i._wD(r+'Attempting to load "'+t.sID+'"',1),t.isHTML5?_t&&t.load(t._iO):(t._iO.autoPlay=!0,t.load(t._iO))):t.readyState===2?(i._wD(r+'Could not load "'+t.sID+'" - exiting',2),p=t):i._wD(r+'"'+t.sID+'" is loading - attempting to play..',1);if(p!==null)return p;!t.isHTML5&&m===9&&t.position>0&&t.position===t.duration&&(i._wD(r+'"'+t.sID+'": Sound at end, resetting to position:0'),e.position=0);if(t.paused&&t.position&&t.position>0)i._wD(r+'"'+t.sID+'" is resuming from paused state',1),t.resume();else{t._iO=L(e,t._iO);if(t._iO.from!==null&&t._iO.to!==null&&t.instanceCount===0&&t.playState===0&&!t._iO.serverURL){a=function(){t._iO=L(e,t._iO),t.play(t._iO)},t.isHTML5&&!t._html5_canplay?(i._wD(r+'Beginning load of "'+t.sID+'" for from/to case'),t.load({_oncanplay:a}),p=!1):!t.isHTML5&&!t.loaded&&(!t.readyState||t.readyState!==2)&&(i._wD(r+'Preloading "'+t.sID+'" for from/to case'),t.load({onload:a}),p=!1);if(p!==null)return p;t._iO=v()}i._wD(r+'"'+t.sID+'" is starting to play'),(!t.instanceCount||t._iO.multiShotEvents||!t.isHTML5&&m>8&&!t.getAutoPlay())&&t.instanceCount++,t._iO.onposition&&t.playState===0&&l(t),t.playState=1,t.paused=!1,t.position=typeof t._iO.position!="undefined"&&!isNaN(t._iO.position)?t._iO.position:0,t.isHTML5||(t._iO=st(it(t._iO))),t._iO.onplay&&n&&(t._iO.onplay.apply(t),c=!0),t.setVolume(t._iO.volume,!0),t.setPan(t._iO.pan,!0),t.isHTML5?(f(),u=t._setup_html5(),t.setPosition(t._iO.position),u.play()):h=s._start(t.sID,t._iO.loops||1,m===9?t._iO.position:t._iO.position/1e3,t._iO.multiShot),m===9&&!h&&(i._wD(r+t.sID+": No sound hardware, or 32-sound ceiling hit"),t._iO.onplayerror&&t._iO.onplayerror.apply(t))}return t},this.start=this.play,this.stop=function(e){var n=t._iO,r;return t.playState===1&&(t._onbufferchange(0),t._resetOnPosition(0),t.paused=!1,t.isHTML5||(t.playState=0),d(),n.to&&t.clearOnPosition(n.to),t.isHTML5?t._a&&(r=t.position,t.setPosition(0),t.position=r,t._a.pause(),t.playState=0,t._onTimer(),u()):(s._stop(t.sID,e),n.serverURL&&t.unload()),t.instanceCount=0,t._iO={},n.onstop&&n.onstop.apply(t)),t},this.setAutoPlay=function(e){i._wD("sound "+t.sID+" turned autoplay "+(e?"on":"off")),t._iO.autoPlay=e,t.isHTML5||(s._setAutoPlay(t.sID,e),e&&!t.instanceCount&&t.readyState===1&&(t.instanceCount++,i._wD("sound "+t.sID+" incremented instance count to "+t.instanceCount)))},this.getAutoPlay=function(){return t._iO.autoPlay},this.setPosition=function(e){e===undefined&&(e=0);var n,r,o,u=t.isHTML5?Math.max(e,0):Math.min(t.duration||t._iO.duration,Math.max(e,0));n=t.position,t.position=u,o=t.position/1e3,t._resetOnPosition(t.position),t._iO.position=u;if(!t.isHTML5)r=m===9?t.position:o,t.readyState&&t.readyState!==2&&s._setPosition(t.sID,r,t.paused||!t.playState,t._iO.multiShot);else if(t._a)if(t._html5_canplay){if(t._a.currentTime!==o){i._wD("setPosition("+o+"): setting position");try{t._a.currentTime=o,(t.playState===0||t.paused)&&t._a.pause()}catch(a){i._wD("setPosition("+o+"): setting position failed: "+a.message,2)}}}else i._wD("setPosition("+o+"): delaying, sound not ready");return t.isHTML5&&t.paused&&t._onTimer(!0),t},this.pause=function(e){return t.paused||t.playState===0&&t.readyState!==1?t:(i._wD("SMSound.pause()"),t.paused=!0,t.isHTML5?(t._setup_html5().pause(),u()):(e||e===undefined)&&s._pause(t.sID,t._iO.multiShot),t._iO.onpause&&t._iO.onpause.apply(t),t)},this.resume=function(){var e=t._iO;return t.paused?(i._wD("SMSound.resume()"),t.paused=!1,t.playState=1,t.isHTML5?(t._setup_html5().play(),f()):(e.isMovieStar&&!e.serverURL&&t.setPosition(t.position),s._pause(t.sID,e.multiShot)),!c&&e.onplay?(e.onplay.apply(t),c=!0):e.onresume&&e.onresume.apply(t),t):t},this.togglePause=function(){return i._wD("SMSound.togglePause()"),t.playState===0?(t.play({position:m===9&&!t.isHTML5?t.position:t.position/1e3}),t):(t.paused?t.resume():t.pause(),t)},this.setPan=function(e,n){return typeof e=="undefined"&&(e=0),typeof n=="undefined"&&(n=!1),t.isHTML5||s._setPan(t.sID,e),t._iO.pan=e,n||(t.pan=e,t.options.pan=e),t},this.setVolume=function(e,n){return typeof e=="undefined"&&(e=100),typeof n=="undefined"&&(n=!1),t.isHTML5?t._a&&(t._a.volume=Math.max(0,Math.min(1,e/100))):s._setVolume(t.sID,i.muted&&!t.muted||t.muted?0:e),t._iO.volume=e,n||(t.volume=e,t.options.volume=e),t},this.mute=function(){return t.muted=!0,t.isHTML5?t._a&&(t._a.muted=!0):s._setVolume(t.sID,0),t},this.unmute=function(){t.muted=!1;var e=typeof t._iO.volume!="undefined";return t.isHTML5?t._a&&(t._a.muted=!1):s._setVolume(t.sID,e?t._iO.volume:t.options.volume),t},this.toggleMute=function(){return t.muted?t.unmute():t.mute()},this.onPosition=function(e,n,r){return h.push({position:parseInt(e,10),method:n,scope:typeof r!="undefined"?r:t,fired:!1}),t},this.onposition=this.onPosition,this.clearOnPosition=function(e,t){var n;e=parseInt(e,10);if(isNaN(e))return!1;for(n=0;n<h.length;n++)e===h[n].position&&(!t||t===h[n].method)&&(h[n].fired&&p--,h.splice(n,1))},this._processOnPosition=function(){var e,n,r=h.length;if(!r||!t.playState||p>=r)return!1;for(e=r-1;e>=0;e--)n=h[e],!n.fired&&t.position>=n.position&&(n.fired=!0,p++,n.method.apply(n.scope,[n.position]));return!0},this._resetOnPosition=function(e){var t,n,r=h.length;if(!r)return!1;for(t=r-1;t>=0;t--)n=h[t],n.fired&&e<=n.position&&(n.fired=!1,p--);return!0},v=function(){var e=t._iO,n=e.from,r=e.to,s,o;return o=function(){i._wD(t.sID+': "to" time of '+r+" reached."),t.clearOnPosition(r,o),t.stop()},s=function(){i._wD(t.sID+': playing "from" '+n),r!==null&&!isNaN(r)&&t.onPosition(r,o)},n!==null&&!isNaN(n)&&(e.position=n,e.multiShot=!1,s()),e},l=function(){var e,n=t._iO.onposition;if(n)for(e in n)n.hasOwnProperty(e)&&t.onPosition(parseInt(e,10),n[e])},d=function(){var e,n=t._iO.onposition;if(n)for(e in n)n.hasOwnProperty(e)&&t.clearOnPosition(parseInt(e,10))},f=function(){t.isHTML5&&lt(t)},u=function(){t.isHTML5&&ct(t)},n=function(e){e||(h=[],p=0),c=!1,t._hasTimer=null,t._a=null,t._html5_canplay=!1,t.bytesLoaded=null,t.bytesTotal=null,t.duration=t._iO&&t._iO.duration?t._iO.duration:null,t.durationEstimate=null,t.eqData=[],t.eqData.left=[],t.eqData.right=[],t.failures=0,t.isBuffering=!1,t.instanceOptions={},t.instanceCount=0,t.loaded=!1,t.metadata={},t.readyState=0,t.muted=!1,t.paused=!1,t.peakData={left:0,right:0},t.waveformData={left:[],right:[]},t.playState=0,t.position=null},n(),this._onTimer=function(e){var n,r=!1,i,s={};if(t._hasTimer||e)return t._a&&(e||(t.playState>0||t.readyState===1)&&!t.paused)&&(n=t._get_html5_duration(),n!==y.duration&&(y.duration=n,t.duration=n,r=!0),t.durationEstimate=t.duration,i=t._a.currentTime*1e3||0,i!==y.time&&(y.time=i,r=!0),(r||e)&&t._whileplaying(i,s,s,s,s)),r},this._get_html5_duration=function(){var e=t._iO,n=t._a?t._a.duration*1e3:e?e.duration:undefined,r=n&&!isNaN(n)&&n!==Infinity?n:e?e.duration:null;return r},this._apply_loop=function(e,t){!e.loop&&t>1&&i._wD("Note: Native HTML5 looping is infinite."),e.loop=t>1?"loop":""},this._setup_html5=function(e){var s=L(t._iO,e),o=decodeURI,u=Ct?i._global_a:t._a,a=o(s.url),f=u&&u._t?u._t.instanceOptions:null,l;if(u){if(u._t){!Ct&&a===o(g)?l=u:Ct&&f.url===s.url&&(!g||g===f.url)&&(l=u);if(l)return t._apply_loop(u,s.loops),l}i._wD("setting new URL on existing object: "+a+(g?", old URL: "+g:"")),Ct&&u._t&&u._t.playState&&s.url!==f.url&&u._t.stop(),n(f.url?s.url===f.url:g?g===s.url:!1),u.src=s.url,t.url=s.url,g=s.url,u._called_load=!1}else i._wD("creating HTML5 Audio() element with URL: "+a),u=new Audio(s.url),u._called_load=!1,Ct&&(i._global_a=u);return t.isHTML5=!0,t._a=u,u._t=t,r(),t._apply_loop(u,s.loops),s.autoLoad||s.autoPlay?t.load():(u.autobuffer=!1,u.preload="none",Ft||t.load()),u},r=function(){function n(e,n,r){return t._a?t._a.addEventListener(e,n,r||!1):null}if(t._a._added_events)return!1;var e;i._wD(a+"adding event listeners: "+t.sID),t._a._added_events=!0;for(e in Ot)Ot.hasOwnProperty(e)&&n(e,Ot[e]);return!0},o=function(){function n(e,n,r){return t._a?t._a.removeEventListener(e,n,r||!1):null}var e;i._wD(a+"removing event listeners: "+t.sID),t._a._added_events=!1;for(e in Ot)Ot.hasOwnProperty(e)&&n(e,Ot[e])},this._onload=function(e){var n,r=!!e;return n="SMSound._onload(): ",i._wD(n+'"'+t.sID+'"'+(r?" loaded.":" failed to load? - "+t.url),r?1:2),!r&&!t.isHTML5&&(i.sandbox.noRemote===!0&&i._wD(n+Z("noNet"),1),i.sandbox.noLocal===!0&&i._wD(n+Z("noLocal"),1)),t.loaded=r,t.readyState=r?3:2,t._onbufferchange(0),t._iO.onload&&t._iO.onload.apply(t,[r]),!0},this._onbufferchange=function(e){return t.playState===0?!1:e&&t.isBuffering||!e&&!t.isBuffering?!1:(t.isBuffering=e===1,t._iO.onbufferchange&&(i._wD("SMSound._onbufferchange(): "+e),t._iO.onbufferchange.apply(t)),!0)},this._onsuspend=function(){return t._iO.onsuspend&&(i._wD("SMSound._onsuspend()"),t._iO.onsuspend.apply(t)),!0},this._onfailure=function(e,n,r){t.failures++,i._wD('SMSound._onfailure(): "'+t.sID+'" count '+t.failures),t._iO.onfailure&&t.failures===1?t._iO.onfailure(t,e,n,r):i._wD("SMSound._onfailure(): ignoring")},this._onfinish=function(){var e=t._iO.onfinish;t._onbufferchange(0),t._resetOnPosition(0),t.instanceCount&&(t.instanceCount--,t.instanceCount||(d(),t.playState=0,t.paused=!1,t.instanceCount=0,t.instanceOptions={},t._iO={},u()),(!t.instanceCount||t._iO.multiShotEvents)&&e&&(i._wD('SMSound._onfinish(): "'+t.sID+'"'),e.apply(t)))},this._whileloading=function(e,n,r,i){var s=t._iO;t.bytesLoaded=e,t.bytesTotal=n,t.duration=Math.floor(r),t.bufferLength=i,s.isMovieStar?(t.durationEstimate=t.duration,t.readyState!==3&&s.whileloading&&s.whileloading.apply(t)):(s.duration?t.durationEstimate=t.duration>s.duration?t.duration:s.duration:t.durationEstimate=parseInt(t.bytesTotal/t.bytesLoaded*t.duration,10),t.durationEstimate===undefined&&(t.durationEstimate=t.duration),t.readyState!==3&&s.whileloading&&s.whileloading.apply(t))},this._whileplaying=function(e,n,r,i,s){var o=t._iO,u;return isNaN(e)||e===null?!1:(t.position=e,t._processOnPosition(),!t.isHTML5&&m>8&&(o.usePeakData&&typeof n!="undefined"&&n&&(t.peakData={left:n.leftPeak,right:n.rightPeak}),o.useWaveformData&&typeof r!="undefined"&&r&&(t.waveformData={left:r.split(","),right:i.split(",")}),o.useEQData&&typeof s!="undefined"&&s&&s.leftEQ&&(u=s.leftEQ.split(","),t.eqData=u,t.eqData.left=u,typeof s.rightEQ!="undefined"&&s.rightEQ&&(t.eqData.right=s.rightEQ.split(",")))),t.playState===1&&(!t.isHTML5&&m===8&&!t.position&&t.isBuffering&&t._onbufferchange(0),o.whileplaying&&o.whileplaying.apply(t)),!0)},this._oncaptiondata=function(e){i._wD('SMSound._oncaptiondata(): "'+this.sID+'" caption data received.'),t.captiondata=e,t._iO.oncaptiondata&&t._iO.oncaptiondata.apply(t)},this._onmetadata=function(e,n){i._wD('SMSound._onmetadata(): "'+this.sID+'" metadata received.');var r={},s,o;for(s=0,o=e.length;s<o;s++)r[e[s]]=n[s];t.metadata=r,t._iO.onmetadata&&t._iO.onmetadata.apply(t)},this._onid3=function(e,n){i._wD('SMSound._onid3(): "'+this.sID+'" ID3 data received.');var r=[],s,o;for(s=0,o=e.length;s<o;s++)r[e[s]]=n[s];t.id3=L(t.id3,r),t._iO.onid3&&t._iO.onid3.apply(t)},this._onconnect=function(e){e=e===1,i._wD('SMSound._onconnect(): "'+t.sID+'"'+(e?" connected.":" failed to connect? - "+t.url),e?1:2),t.connected=e,e&&(t.failures=0,ut(t.sID)&&(t.getAutoPlay()?t.play(undefined,t.getAutoPlay()):t._iO.autoLoad&&t.load()),t._iO.onconnect&&t._iO.onconnect.apply(t,[e]))},this._ondataerror=function(e){t.playState>0&&(i._wD("SMSound._ondataerror(): "+e),t._iO.ondataerror&&t._iO.ondataerror.apply(t))}},R=function(){return p.body||p._docElement||p.getElementsByTagName("div")[0]},f=function(e){return p.getElementById(e)},L=function(e,t){var n={},r,s,o;for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);s=typeof t=="undefined"?i.defaultOptions:t;for(o in s)s.hasOwnProperty(o)&&typeof n[o]=="undefined"&&(n[o]=s[o]);return n},Tt=function(){function n(t){var n=Nt.call(t),r=n.length;return e?(n[1]="on"+n[1],r>3&&n.pop()):r===3&&n.push(!1),n}function r(n,r){var i=n.shift(),s=[t[r]];e?i[s](n[0],n[1]):i[s].apply(i,n)}function i(){r(n(arguments),"add")}function s(){r(n(arguments),"remove")}var e=c.attachEvent,t={add:e?"attachEvent":"addEventListener",remove:e?"detachEvent":"removeEventListener"};return{add:i,remove:s}}(),Ot={abort:Gt(function(){i._wD(a+"abort: "+this._t.sID)}),canplay:Gt(function(){var e=this._t,t;if(e._html5_canplay)return!0;e._html5_canplay=!0,i._wD(a+"canplay: "+e.sID+", "+e.url),e._onbufferchange(0),t=isNaN(e.position)?null:e.position/1e3;if(e.position&&this.currentTime!==t){i._wD(a+"canplay: setting position to "+t);try{this.currentTime=t}catch(n){i._wD(a+"setting position failed: "+n.message,2)}}e._iO._oncanplay&&e._iO._oncanplay()}),load:Gt(function(){var e=this._t;e.loaded||(e._onbufferchange(0),e._whileloading(e.bytesTotal,e.bytesTotal,e._get_html5_duration()),e._onload(!0))}),ended:Gt(function(){var e=this._t;i._wD(a+"ended: "+e.sID),e._onfinish()}),error:Gt(function(){i._wD(a+"error: "+this.error.code),this._t._onload(!1)}),loadeddata:Gt(function(){var e=this._t,t=e.bytesTotal||1;i._wD(a+"loadeddata: "+this._t.sID),!e._loaded&&!Bt&&(e.duration=e._get_html5_duration(),e._whileloading(t,t,e._get_html5_duration()),e._onload(!0))}),loadedmetadata:Gt(function(){i._wD(a+"loadedmetadata: "+this._t.sID)}),loadstart:Gt(function(){i._wD(a+"loadstart: "+this._t.sID),this._t._onbufferchange(1)}),play:Gt(function(){i._wD(a+"play: "+this._t.sID+", "+this._t.url),this._t._onbufferchange(0)}),playing:Gt(function(){i._wD(a+"playing: "+this._t.sID),this._t._onbufferchange(0)}),progress:Gt(function(e){var t=this._t,n,r,s,o=0,u=e.type==="progress",f=e.target.buffered,l=e.loaded||0,c=e.total||1;if(t.loaded)return!1;if(f&&f.length){for(n=f.length-1;n>=0;n--)o=f.end(n)-f.start(n);l=o/e.target.duration;if(u&&f.length>1){s=[],r=f.length;for(n=0;n<r;n++)s.push(e.target.buffered.start(n)+"-"+e.target.buffered.end(n));i._wD(a+"progress: timeRanges: "+s.join(", "))}u&&!isNaN(l)&&i._wD(a+"progress: "+t.sID+": "+Math.floor(l*100)+"% loaded")}isNaN(l)||(t._onbufferchange(0),t._whileloading(l,c,t._get_html5_duration()),l&&c&&l===c&&Ot.load.call(this,e))}),ratechange:Gt(function(){i._wD(a+"ratechange: "+this._t.sID)}),suspend:Gt(function(e){var t=this._t;i._wD(a+"suspend: "+t.sID),Ot.progress.call(this,e),t._onsuspend()}),stalled:Gt(function(){i._wD(a+"stalled: "+this._t.sID)}),timeupdate:Gt(function(){this._t._onTimer()}),waiting:Gt(function(){var e=this._t;i._wD(a+"waiting: "+e.sID),e._onbufferchange(1)})},yt=function(e){return!e.serverURL&&(e.type?bt({type:e.type}):bt({url:e.url})||i.html5Only)},Et=function(e){e&&(e.src=Dt?"":Xt)},bt=function(e){function f(e){return i.preferFlash&&kt&&!i.ignoreFlash&&typeof i.flash[e]!="undefined"&&i.flash[e]}if(!i.useHTML5Audio||!i.hasHTML5)return!1;var t=e.url||null,n=e.type||null,r=i.audioFormats,s,o,u,a;if(n&&typeof i.html5[n]!="undefined")return i.html5[n]&&!f(n);if(!wt){wt=[];for(a in r)r.hasOwnProperty(a)&&(wt.push(a),r[a].related&&(wt=wt.concat(r[a].related)));wt=new RegExp("\\.("+wt.join("|")+")(\\?.*)?$","i")}return u=t?t.toLowerCase().match(wt):null,!u||!u.length?n?(o=n.indexOf(";"),u=(o!==-1?n.substr(0,o):n).substr(6)):s=!1:u=u[1],u&&typeof i.html5[u]!="undefined"?s=i.html5[u]&&!f(u):(n="audio/"+u,s=i.html5.canPlayType({type:n}),i.html5[u]=s,s=s&&i.html5[n]&&!f(n)),s},xt=function(){function o(t){var n,r,s,o=!1,u=!1;if(!e||typeof e.canPlayType!="function")return o;if(t instanceof Array){for(r=0,s=t.length;r<s&&!u;r++)if(i.html5[t[r]]||e.canPlayType(t[r]).match(i.html5Test))u=!0,i.html5[t[r]]=!0,i.flash[t[r]]=!!(i.preferFlash&&kt&&t[r].match(Wt));o=u}else n=e&&typeof e.canPlayType=="function"?e.canPlayType(t):!1,o=!!n&&!!n.match(i.html5Test);return o}if(!i.useHTML5Audio||typeof Audio=="undefined")return!1;var e=typeof Audio!="undefined"?jt?new Audio(null):new Audio:null,t,n={},r,s;r=i.audioFormats;for(t in r)if(r.hasOwnProperty(t)){n[t]=o(r[t].type),n["audio/"+t]=n[t],i.preferFlash&&!i.ignoreFlash&&t.match(Wt)?i.flash[t]=!0:i.flash[t]=!1;if(r[t]&&r[t].related)for(s=r[t].related.length-1;s>=0;s--)n["audio/"+r[t].related[s]]=n[t],i.html5[r[t].related[s]]=n[t],i.flash[r[t].related[s]]=n[t]}return n.canPlayType=e?o:null,i.html5=L(i.html5,n),!0},B={notReady:"Not loaded yet - wait for soundManager.onload()/onready()",notOK:"Audio support is not available.",domError:u+"createMovie(): appendChild/innerHTML call failed. DOM not ready or other error.",spcWmode:u+"createMovie(): Removing wmode, preventing known SWF loading issue(s)",swf404:o+": Verify that %s is a valid path.",tryDebug:"Try "+o+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:o+": Non-HTTP page ("+p.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:o+": Special case: Waiting for focus-related event..",waitImpatient:o+": Getting impatient, still waiting for Flash%s...",waitForever:o+": Waiting indefinitely for Flash (will recover if unblocked)...",needFunction:o+": Function object expected for %s",badID:'Warning: Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:"--- "+o+"._debug(): Current sound objects ---",waitEI:u+"initMovie(): Waiting for ExternalInterface call from Flash..",waitOnload:o+": Waiting for window.onload()",docLoaded:o+": Document already loaded",onload:u+"initComplete(): calling soundManager.onload()",onloadOK:o+".onload() complete",init:u+"init()",didInit:u+"init(): Already called?",flashJS:o+": Attempting to call Flash from JS..",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:"Warning: Failed to remove flash movie.",shutdown:o+".disable(): Shutting down",queue:o+": Queueing %s handler",smFail:o+": Failed to initialise.",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+nt.swfTimedout+" CSS..",fbLoaded:"Flash loaded",fbHandler:u+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:o+".load(): current URL already assigned.",badFV:o+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",mfOn:"mobileFlash::enabling on-screen flash repositioning",policy:"Enabling usePolicyFile for data access"},Z=function(){var e=Nt.call(arguments),t=e.shift(),n=B&&B[t]?B[t]:"",r,i;if(n&&e&&e.length)for(r=0,i=e.length;r<i;r++)n=n.replace("%s",e[r]);return n},it=function(e){return m===8&&e.loops>1&&e.stream&&(N("as2loop"),e.stream=!1),e},st=function(e,t){return e&&!e.usePolicyFile&&(e.onid3||e.usePeakData||e.useWaveformData||e.useEQData)&&(i._wD((t||"")+Z("policy")),e.usePolicyFile=!0),e},ot=function(e){typeof console!="undefined"&&typeof console.warn!="undefined"?console.warn(e):i._wD(e)},d=function(){return!1},J=function(e){var t;for(t in e)e.hasOwnProperty(t)&&typeof e[t]=="function"&&(e[t]=d);t=null},K=function(e){typeof e=="undefined"&&(e=!1);if(x||e)N("smFail",2),i.disable(e)},Q=function(e){var t=null,n;if(e)if(e.match(/\.swf(\?.*)?$/i)){t=e.substr(e.toLowerCase().lastIndexOf(".swf?")+4);if(t)return e}else e.lastIndexOf("/")!==e.length-1&&(e+="/");return n=(e&&e.lastIndexOf("/")!==-1?e.substr(0,e.lastIndexOf("/")+1):"./")+i.movieURL,i.noSWFCache&&(n+="?ts="+(new Date).getTime()),n},P=function(){m=parseInt(i.flashVersion,10),m!==8&&m!==9&&(i._wD(Z("badFV",m,$)),i.flashVersion=m=$);var e=i.debugMode||i.debugFlash?"_debug.swf":".swf";i.useHTML5Audio&&!i.html5Only&&i.audioFormats.mp4.required&&m<9&&(i._wD(Z("needfl9")),i.flashVersion=m=9),i.version=i.versionNumber+(i.html5Only?" (HTML5-only mode)":m===9?" (AS3/Flash 9)":" (AS2/Flash 8)"),m>8?(i.defaultOptions=L(i.defaultOptions,i.flash9Options),i.features.buffering=!0,i.defaultOptions=L(i.defaultOptions,i.movieStarOptions),i.filePatterns.flash9=new RegExp("\\.(mp3|"+Kt.join("|")+")(\\?.*)?$","i"),i.features.movieStar=!0):i.features.movieStar=!1,i.filePattern=i.filePatterns[m!==8?"flash9":"flash8"],i.movieURL=(m===8?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",e),i.features.peakData=i.features.waveformData=i.features.eqData=m>8},W=function(e,t){if(!s)return!1;s._setPolling(e,t)},X=function(){i.debugURLParam.test(h)&&(i.debugMode=!0);if(f(i.debugID))return!1;var e,t,n,r,s;if(i.debugMode&&!f(i.debugID)&&(!qt||!i.useConsole||!i.consoleOnly)){e=p.createElement("div"),e.id=i.debugID+"-toggle",r={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001},e.appendChild(p.createTextNode("-")),e.onclick=rt,e.title="Toggle SM2 debug console",l.match(/msie 6/i)&&(e.style.position="absolute",e.style.cursor="hand");for(s in r)r.hasOwnProperty(s)&&(e.style[s]=r[s]);t=p.createElement("div"),t.id=i.debugID,t.style.display=i.debugMode?"block":"none";if(i.debugMode&&!f(e.id)){try{n=R(),n.appendChild(e)}catch(o){throw new Error(Z("domError")+" \n"+o.toString())}n.appendChild(t)}}n=null},ut=this.getSoundById,N=function(e,t){return e?i._wD(Z(e),t):""},h.indexOf("sm2-debug=alert")+1&&i.debugMode&&(i._wD=function(t){e.alert(t)}),rt=function(){var e=f(i.debugID),t=f(i.debugID+"-toggle");if(!e)return!1;y?(t.innerHTML="+",e.style.display="none"):(t.innerHTML="-",e.style.display="block"),y=!y},b=function(e,t,n){if(typeof sm2Debugger!="undefined")try{sm2Debugger.handleEvent(e,t,n)}catch(r){}return!0},tt=function(){var e=[];return i.debugMode&&e.push(nt.sm2Debug),i.debugFlash&&e.push(nt.flashDebug),i.useHighPerformance&&e.push(nt.highPerf),e.join(" ")},et=function(){var e=Z("fbHandler"),t=i.getMoviePercent(),n=nt,r={type:"FLASHBLOCK"};if(i.html5Only)return!1;i.ok()?(i.didFlashBlock&&i._wD(e+": Unblocked"),i.oMC&&(i.oMC.className=[tt(),n.swfDefault,n.swfLoaded+(i.didFlashBlock?" "+n.swfUnblocked:"")].join(" "))):(mt&&(i.oMC.className=tt()+" "+n.swfDefault+" "+(t===null?n.swfTimedout:n.swfError),i._wD(e+": "+Z("fbTimeout")+(t?" ("+Z("fbLoaded")+")":""))),i.didFlashBlock=!0,O({type:"ontimeout",ignoreInit:!0,error:r}),z(r))},A=function(e,t,n){typeof g[e]=="undefined"&&(g[e]=[]),g[e].push({method:t,scope:n||null,fired:!1})},O=function(e){e||(e={type:i.ok()?"onready":"ontimeout"});if(!S&&e&&!e.ignoreInit)return!1;if(e.type==="ontimeout"&&(i.ok()||x&&!e.ignoreInit))return!1;var t={success:e&&e.ignoreInit?i.ok():!x},n=e&&e.type?g[e.type]||[]:[],r=[],s,u,a=[t],f=mt&&i.useFlashBlock&&!i.ok();e.error&&(a[0].error=e.error);for(s=0,u=n.length;s<u;s++)n[s].fired!==!0&&r.push(n[s]);if(r.length){i._wD(o+": Firing "+r.length+" "+e.type+"() item"+(r.length===1?"":"s"));for(s=0,u=r.length;s<u;s++)r[s].scope?r[s].method.apply(r[s].scope,a):r[s].method.apply(this,a),f||(r[s].fired=!0)}return!0},M=function(){c.setTimeout(function(){i.useFlashBlock&&et(),O(),i.onload instanceof Function&&(N("onload",1),i.onload.apply(c),N("onloadOK",1)),i.waitForWindowLoad&&Tt.add(c,"load",M)},1)},Lt=function(){if(kt!==undefined)return kt;var e=!1,t=navigator,n=t.plugins,r,i,s,o=c.ActiveXObject;if(n&&n.length)i="application/x-shockwave-flash",s=t.mimeTypes,s&&s[i]&&s[i].enabledPlugin&&s[i].enabledPlugin.description&&(e=!0);else if(typeof o!="undefined"){try{r=new o("ShockwaveFlash.ShockwaveFlash")}catch(u){}e=!!r}return kt=e,e},gt=function(){var e,t,n=!0,r=_t&&!!l.match(/os (1|2|3_0|3_1)/i);r?(i.hasHTML5=!1,i.html5Only=!0,i.oMC&&(i.oMC.style.display="none"),n=!1):i.useHTML5Audio&&(!i.html5||!i.html5.canPlayType?(i._wD("SoundManager: No HTML5 Audio() support detected."),i.hasHTML5=!1):i.hasHTML5=!0,It&&i._wD(u+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(kt?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1));if(i.useHTML5Audio&&i.hasHTML5)for(t in i.audioFormats)i.audioFormats.hasOwnProperty(t)&&(i.audioFormats[t].required&&!i.html5.canPlayType(i.audioFormats[t].type)||i.flash[t]||i.flash[i.audioFormats[t].type])&&(e=!0);return i.ignoreFlash&&(e=!1),i.html5Only=i.hasHTML5&&i.useHTML5Audio&&!e,!i.html5Only},vt=function(e){var t,n,r=0,s;if(e instanceof Array){for(t=0,n=e.length;t<n;t++)if(e[t]instanceof Object){if(i.canPlayMIME(e[t].type)){r=t;break}}else if(i.canPlayURL(e[t])){r=t;break}e[r].url&&(e[r]=e[r].url),s=e[r]}else s=e;return s},lt=function(t){t._hasTimer||(t._hasTimer=!0,!Ft&&i.html5PollingInterval&&(dt===null&&pt===0&&(dt=e.setInterval(ht,i.html5PollingInterval)),pt++))},ct=function(e){e._hasTimer&&(e._hasTimer=!1,!Ft&&i.html5PollingInterval&&pt--)},ht=function(){var t;if(dt!==null&&!pt)return e.clearInterval(dt),dt=null,!1;for(t=i.soundIDs.length-1;t>=0;t--)i.sounds[i.soundIDs[t]].isHTML5&&i.sounds[i.soundIDs[t]]._hasTimer&&i.sounds[i.soundIDs[t]]._onTimer()},z=function(e){e=typeof e!="undefined"?e:{},i.onerror instanceof Function&&i.onerror.apply(c,[{type:typeof e.type!="undefined"?e.type:null}]),typeof e.fatal!="undefined"&&e.fatal&&i.disable()},At=function(){if(!It||!Lt())return!1;var e=i.audioFormats,t,n;for(n in e)if(e.hasOwnProperty(n))if(n==="mp3"||n==="mp4"){i._wD(o+": Using flash fallback for "+n+" format"),i.html5[n]=!1;if(e[n]&&e[n].related)for(t=e[n].related.length-1;t>=0;t--)i.html5[e[n].related[t]]=!1}},this._setSandboxType=function(e){var t=i.sandbox;t.type=e,t.description=t.types[typeof t.types[e]!="undefined"?e:"unknown"],i._wD("Flash security sandbox type: "+t.type),t.type==="localWithFile"?(t.noRemote=!0,t.noLocal=!1,N("secNote",2)):t.type==="localWithNetwork"?(t.noRemote=!1,t.noLocal=!0):t.type==="localTrusted"&&(t.noRemote=!1,t.noLocal=!1)},this._externalInterfaceOK=function(e,t){if(i.swfLoaded)return!1;var n,r=(new Date).getTime();i._wD(u+"externalInterfaceOK()"+(e?" (~"+(r-e)+" ms)":"")),b("swf",!0),b("flashtojs",!0),i.swfLoaded=!0,Ut=!1,It&&At();if(!t||t.replace(/\+dev/i,"")!==i.versionNumber.replace(/\+dev/i,""))return n=o+': Fatal: JavaScript file build "'+i.versionNumber+'" does not match Flash SWF build "'+t+'" at '+i.url+". Ensure both are up-to-date.",setTimeout(function(){throw new Error(n)},0),!1;Pt?setTimeout(v,100):v()},U=function(e,t){function n(){i._wD("-- SoundManager 2 "+i.version+(!i.html5Only&&i.useHTML5Audio?i.hasHTML5?" + HTML5 audio":", no HTML5 audio support":"")+(i.html5Only?"":(i.useHighPerformance?", high performance mode, ":", ")+((i.flashPollingInterval?"custom ("+i.flashPollingInterval+"ms)":"normal")+" polling")+(i.wmode?", wmode: "+i.wmode:"")+(i.debugFlash?", flash debug mode":"")+(i.useFlashBlock?", flashBlock mode":""))+" --",1)}function k(e,t){return'<param name="'+e+'" value="'+t+'" />'}if(w&&E)return!1;if(i.html5Only)return P(),n(),i.oMC=f(i.movieID),v(),w=!0,E=!0,!1;var r=t||i.url,s=i.altURL||r,o="JS/Flash audio component (SoundManager 2)",a,c,h=R(),d,m,g,y=tt(),b,S,x,T=null,C=p.getElementsByTagName("html")[0];T=C&&C.dir&&C.dir.match(/rtl/i),e=typeof e=="undefined"?i.id:e,P(),i.url=Q(Vt?r:s),t=i.url,i.wmode=!i.wmode&&i.useHighPerformance?"transparent":i.wmode,i.wmode!==null&&(l.match(/msie 8/i)||!Pt&&!i.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(N("spcWmode"),i.wmode=null),a={name:e,id:e,src:t,quality:"high",allowScriptAccess:i.allowScriptAccess,bgcolor:i.bgColor,pluginspage:$t+"www.macromedia.com/go/getflashplayer",title:o,type:"application/x-shockwave-flash",wmode:i.wmode,hasPriority:"true"},i.debugFlash&&(a.FlashVars="debug=1"),i.wmode||delete a.wmode;if(Pt)c=p.createElement("div"),m=['<object id="'+e+'" data="'+t+'" type="'+a.type+'" title="'+a.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+$t+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',k("movie",t),k("AllowScriptAccess",i.allowScriptAccess),k("quality",a.quality),i.wmode?k("wmode",i.wmode):"",k("bgcolor",i.bgColor),k("hasPriority","true"),i.debugFlash?k("FlashVars",a.FlashVars):"","</object>"].join("");else{c=p.createElement("embed");for(d in a)a.hasOwnProperty(d)&&c.setAttribute(d,a[d])}X(),y=tt(),h=R();if(h){i.oMC=f(i.movieID)||p.createElement("div");if(!i.oMC.id){i.oMC.id=i.movieID,i.oMC.className=nt.swfDefault+" "+y,b=null,g=null,i.useFlashBlock||(i.useHighPerformance?b={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(b={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},T&&(b.left=Math.abs(parseInt(b.left,10))+"px"))),Ht&&(i.oMC.style.zIndex=1e4);if(!i.debugFlash)for(S in b)b.hasOwnProperty(S)&&(i.oMC.style[S]=b[S]);try{Pt||i.oMC.appendChild(c),h.appendChild(i.oMC),Pt&&(g=i.oMC.appendChild(p.createElement("div")),g.className=nt.swfBox,g.innerHTML=m),E=!0}catch(L){throw new Error(Z("domError")+" \n"+L.toString())}}else x=i.oMC.className,i.oMC.className=(x?x+" ":nt.swfDefault)+(y?" "+y:""),i.oMC.appendChild(c),Pt&&(g=i.oMC.appendChild(p.createElement("div")),g.className=nt.swfBox,g.innerHTML=m),E=!0}return w=!0,n(),i._wD(u+"createMovie(): Trying to load "+t+(!Vt&&i.altURL?" (alternate URL)":""),1),!0},j=function(){return i.html5Only?(U(),!1):s?!1:(s=i.getMovie(i.id),s||(G?(Pt?i.oMC.innerHTML=Y:i.oMC.appendChild(G),G=null,w=!0):U(i.id,i.url),s=i.getMovie(i.id)),s&&N("waitEI"),i.oninitmovie instanceof Function&&setTimeout(i.oninitmovie,1),!0)},_=function(){setTimeout(D,1e3)},D=function(){if(at)return!1;at=!0,Tt.remove(c,"load",_);if(Ut&&!Rt)return N("waitFocus"),!1;var e;S||(e=i.getMoviePercent(),i._wD(Z("waitImpatient",e===100?" (SWF loaded)":e>0?" (SWF "+e+"% loaded)":""))),setTimeout(function(){e=i.getMoviePercent(),S||(i._wD(o+": No Flash response within expected time.\nLikely causes: "+(e===0?"Loading "+i.movieURL+" may have failed (and/or Flash "+m+"+ not present?), ":"")+"Flash blocked or JS-Flash security error."+(i.debugFlash?" "+Z("checkSWF"):""),2),!Vt&&e&&(N("localFail",2),i.debugFlash||N("tryDebug",2)),e===0&&i._wD(Z("swf404",i.url)),b("flashtojs",!1,": Timed out"+Vt?" (Check flash security or flash blockers)":" (No plugin/missing SWF?)")),!S&&zt&&(e===null?i.useFlashBlock||i.flashLoadTimeout===0?(i.useFlashBlock&&et(),N("waitForever")):K(!0):i.flashLoadTimeout===0?N("waitForever"):K(!0))},i.flashLoadTimeout)},H=function(){function e(){Tt.remove(c,"focus",H),Tt.remove(c,"load",H)}return Rt||!Ut?(e(),!0):(zt=!0,Rt=!0,i._wD(u+"handleFocus()"),Bt&&Ut&&Tt.remove(c,"mousemove",H),at=!1,e(),!0)},Mt=function(){var e,t=[];if(i.useHTML5Audio&&i.hasHTML5){for(e in i.audioFormats)i.audioFormats.hasOwnProperty(e)&&t.push(e+": "+i.html5[e]+(!i.html5[e]&&kt&&i.flash[e]?" (using flash)":i.preferFlash&&i.flash[e]&&kt?" (preferring flash)":i.html5[e]?"":" ("+(i.audioFormats[e].required?"required, ":"")+"and no flash support)"));i._wD("-- SoundManager 2: HTML5 support tests ("+i.html5Test+"): "+t.join(", ")+" --",1)}},k=function(e){if(S)return!1;if(i.html5Only)return i._wD("-- SoundManager 2: loaded --"),S=!0,M(),b("onload",!0),!0;var t=i.useFlashBlock&&i.flashLoadTimeout&&!i.getMoviePercent(),n=!0,r;return t||(S=!0,x&&(r={type:!kt&&mt?"NO_FLASH":"INIT_TIMEOUT"})),i._wD("-- SoundManager 2 "+(x?"failed to load":"loaded")+" ("+(x?"security/load error":"OK")+") --",1),x||e?(i.useFlashBlock&&i.oMC&&(i.oMC.className=tt()+" "+(i.getMoviePercent()===null?nt.swfTimedout:nt.swfError)),O({type:"ontimeout",error:r}),b("onload",!1),z(r),n=!1):b("onload",!0),i.waitForWindowLoad&&!T?(N("waitOnload"),Tt.add(c,"load",M)):(i.waitForWindowLoad&&T&&N("docLoaded"),M()),n},v=function(){function e(){Tt.remove(c,"load",i.beginDelayedInit)}N("init");if(S)return N("didInit"),!1;if(i.html5Only)return S||(e(),i.enabled=!0,k()),!0;j();try{N("flashJS"),s._externalInterfaceTest(!1),W(!0,i.flashPollingInterval||(i.useHighPerformance?10:50)),i.debugMode||s._disableDebug(),i.enabled=!0,b("jstoflash",!0),i.html5Only||Tt.add(c,"unload",d)}catch(t){return i._wD("js/flash exception: "+t.toString()),b("jstoflash",!1),z({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),K(!0),k(),!1}return k(),e(),!0},F=function(){return q?!1:(q=!0,X(),function(){var e="sm2-usehtml5audio=",t=h.toLowerCase(),n=null,r="sm2-preferflash=",s=null,o=typeof console!="undefined"&&typeof console.log!="undefined";t.indexOf(e)!==-1&&(n=t.charAt(t.indexOf(e)+e.length)==="1",o&&console.log((n?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter"),i.useHTML5Audio=n),t.indexOf(r)!==-1&&(s=t.charAt(t.indexOf(r)+r.length)==="1",o&&console.log((s?"Enabling ":"Disabling ")+"preferFlash via URL parameter"),i.preferFlash=s)}(),!kt&&i.hasHTML5&&(i._wD("SoundManager: No Flash detected"+(i.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5.")),i.useHTML5Audio=!0,i.preferFlash=!1),xt(),i.html5.usingFlash=gt(),mt=i.html5.usingFlash,Mt(),!kt&&mt&&(i._wD("SoundManager: Fatal error: Flash is needed to play some required formats, but is not available."),i.flashLoadTimeout=1),p.removeEventListener&&p.removeEventListener("DOMContentLoaded",F,!1),j(),!0)},St=function(){return p.readyState==="complete"&&(F(),p.detachEvent("onreadystatechange",St)),!0},I=function(){T=!0,Tt.remove(c,"load",I)},Lt(),Tt.add(c,"focus",H),Tt.add(c,"load",H),Tt.add(c,"load",_),Tt.add(c,"load",I),Bt&&Ut&&Tt.add(c,"mousemove",H),p.addEventListener?p.addEventListener("DOMContentLoaded",F,!1):p.attachEvent?p.attachEvent("onreadystatechange",St):(b("onload",!1),z({type:"NO_DOM2_EVENTS",fatal:!0})),p.readyState==="complete"&&setTimeout(F,100)}var t=null;if(typeof SM2_DEFER=="undefined"||!SM2_DEFER)t=new n;e.SoundManager=n,e.soundManager=t}(window),define("soundmanager2",[],function(){}),function(){define("cs!app/soundManager",["require","soundmanager2"],function(e){var t;return e("soundmanager2"),t=new SoundManager,t.url="swf",t.debugMode=!1,t.useFlashBlock=!1,t.flashVersion=9,t.flash9Options.useEQData=!0,t.flash9Options.usePeakData=!0,window.soundManager=t,t.beginDelayedInit(),t})}.call(this),function(){define("cs!app/TimeSeries",["require"],function(e){var t,n;return n=function(e,t){var n,r,i,s,o;s=0,i=t.length-1,o=Math.floor((s+i)/2);while(s<=i){o=Math.floor((s+i)/2),r=t[o],n=t[o+1];if(e<r)i=o-1;else{if(!(e>n))return e===r?r:e===n?n:r;s=o+1}}return t[o]},t=function(){function e(){this.sortedKeys=[],this.keyToValue=[]}return e.prototype.add=function(e,t){var n,r,i,s,o;s=0,i=this.sortedKeys.length-1,o=Math.floor((s+i)/2);while(s<=i){o=Math.floor((s+i)/2),r=this.sortedKeys[o],n=this.sortedKeys[o+1];if(e<r)i=o-1;else{if(!(e>n))return e===r?(this.keyToValue[r]=t,this):e===n?(this.keyToValue[n]=t,this):(this.sortedKeys.splice(o+1,0,e),this.keyToValue[e]=t,this);s=o+1}}return e<this.sortedKeys[o]?this.sortedKeys.splice(o,0,e):this.sortedKeys.splice(o+1,0,e),this.keyToValue[e]=t,this},e.prototype.getClosestKey=function(e){return n(e,this.sortedKeys)},e.prototype.getClosestValue=function(e){var t;return t=n(e,this.sortedKeys),this.keyToValue[t]},e.prototype.getClosestValueNotFartherThan=function(e,t){var r;return r=n(e,this.sortedKeys),Math.abs(e-r)<=t?this.keyToValue[r]:null},e}(),{findClosest:n,TimeSeries:t}})}.call(this),function(){define("cs!app/SoundGrid",["require","cs!app/TimeSeries"],function(e){var t,n,r;return r=e("cs!app/TimeSeries").TimeSeries,t=500,n=function(){function e(e,t,n){this.w=e,this.h=t,this.duration=n,this.timeSeries=new r,this.previousX=0}return e.prototype.resize=function(e,t){return this.w=e,this.h=t,this.renderStripes(0,this.w-1)},e.prototype.addData=function(e,t){var n,r;return this.timeSeries.add(e,t),n=Math.floor(this.w*e/this.duration),r=this.renderStripes(this.previousX,n),this.previousX=n,r},e.prototype.renderStripes=function(e,n){var r,i,s,o,u,a,f,l,c,h;o={};for(a=h=e;e<=n?h<=n:h>=n;a=e<=n?++h:--h)i=a*this.duration/this.w,u=this.timeSeries.getClosestValueNotFartherThan(i,t),u!==null?(r=u*this.h+.25,l=Math.floor(this.h/2-r/2),c=l+r,s=function(){var e,t,n;n=[];for(f=e=0,t=this.h;0<=t?e<t:e>t;f=0<=t?++e:--e)n.push(f>=l&&f<c?1:0);return n}.call(this)):s=null,o[a]=s;return o},e}()})}.call(this),function(){var e={}.hasOwnProperty;define("cs!app/Player",["require","cs!app/SoundGrid"],function(t){var n,r;return r=t("cs!app/SoundGrid"),n=function(){function t(e,t,n,r){var i,s,o=this;e.append("        <div id='cursor'></div>        <canvas id='canvas' width='50' height='100'>          HTML5 Canvas element not supported.        </canvas>        <button id='play-button' class='clickable' disabled='disabled'>          Play</button>"),this.canvas=t("#canvas")[0],this.$playButton=t("#play-button"),this.cursor=t("#cursor")[0],this.context=this.canvas.getContext("2d"),this.theSound=void 0,this.isPaused=!0,this.justSetPosition=!1,this.sm=n,this.sm.onready(function(){return o.theSound=o.sm.createSound({id:"theSound",url:r,useEQData:!0,usePeakData:!0,whileplaying:function(){return o.whilePlaying()},onfinish:function(){return o.onFinish()}}),o.setupPlayButton()}),this.column=this.context.createImageData(1,this.canvas.height),this.soundGrid=null,s=function(){return o.canvas.width=window.innerWidth-16,o.canvas.style.width=""+o.canvas.width+"px"},i=function(e){var n;return n=t("#canvas").offset().left,o.moveCursorTo(e.pageX-n)},t(document).ready(function(){return s(),o.redrawCanvas(),t("#canvas").mousedown(function(e){return i(e),t("#canvas").bind("mousemove",i)}),t("#canvas").mouseup(function(e){return t("#canvas").unbind("mousemove",i)}),t("#cursor").mouseup(function(e){return t("#canvas").unbind("mousemove",i)})}),t(window).resize(function(){return s(),o.redrawCanvas()})}return t.prototype.updatePlayButtonLabel=function(){return this.isPaused?this.$playButton.text("Play"):this.$playButton.text("Pause")},t.prototype.setupPlayButton=function(){var e=this;return this.$playButton.attr("disabled",!1),this.$playButton.bind("click",function(){return e.isPaused?(e.theSound.play(),e.isPaused=!1,e.updatePlayButtonLabel()):(e.theSound.pause(),e.isPaused=!0,e.updatePlayButtonLabel())})},t.prototype.updateCursorX=function(){var e;if(this.theSound&&this.theSound.duration)return e=Math.floor(this.canvas.width*this.theSound.position/this.theSound.duration),this.cursor.style.left=""+(e+1)+"px"},t.prototype.onFinish=function(){try{return this.isPaused=!0,this.updatePlayButtonLabel()}catch(e){return console.log("Error in onFinish: "+e)}},t.prototype.drawStripe=function(e,t){var n,r,i,s,o,u;if(t)for(r=i=0,o=this.column.height;0<=o?i<o:i>o;r=0<=o?++i:--i)n=255-t[r]*255,this.column.data[r*4+0]=n,this.column.data[r*4+1]=n,this.column.data[r*4+2]=n,this.column.data[r*4+3]=255;else for(r=s=0,u=this.column.height;0<=u?s<u:s>u;r=0<=u?++s:--s)this.column.data[r*4+0]=192,this.column.data[r*4+1]=192,this.column.data[r*4+2]=192,this.column.data[r*4+3]=255;return this.context.putImageData(this.column,e,0)},t.prototype.redrawCanvas=function(){var t,n,r,i,s;if(this.soundGrid)n=this.soundGrid.resize(this.canvas.width,this.canvas.height);else{n={};for(r=i=0,s=this.canvas.width;0<=s?i<s:i>s;r=0<=s?++i:--i)n[r]=null}for(r in n){if(!e.call(n,r))continue;t=n[r],this.drawStripe(r,t)}return this.updateCursorX()},t.prototype.whilePlaying=function(){var t,n,i,s,o;this.theSound.duration&&!this.soundGrid&&(this.soundGrid=new r(this.canvas.width,this.canvas.height,this.theSound.duration));try{n=this.theSound.peakData;if(n&&!this.justSetPosition&&this.soundGrid){t=(n.left+n.right)/2,s=this.soundGrid.addData(this.theSound.position,t);for(o in s){if(!e.call(s,o))continue;i=s[o],this.drawStripe(o,i)}}return this.updateCursorX(),this.justSetPosition=!1}catch(u){return console.log("Error in whilePlaying: "+u)}},t.prototype.moveCursorTo=function(e){var t;return t=e*this.theSound.duration/this.canvas.width,this.justSetPosition=!0,this.theSound.setPosition(t),this.updateCursorX()},t.prototype.getPosition=function(){return this.theSound.position},t}()})}.call(this),function(){define("cs!app/WordLinks",["require","jquery","cs!app/soundManager"],function(e){var t,n,r;return t=e("jquery"),r=e("cs!app/soundManager"),n=function(e){var n;return n=t.getJSON("/media/lyrics_json/"+e+".json"),n.success(function(e){var n,i,s,o,u,a,f,l,c,h,p,d,v,m,g=this;a={};for(f=0,h=e.length;f<h;f++){s=e[f],m=s.lyric.split(" ");for(l=0,p=m.length;l<p;l++)u=m[l],a[v=u.toLowerCase()]||(a[v]=0),a[u.toLowerCase()]+=1}o=Object.keys(a),o.sort(function(e,t){return e<t?-1:e>t?1:0});for(c=0,d=o.length;c<d;c++)u=o[c],n=a[u],i="",i+="<li>",i+="<a class='js-word-link' data-word='"+u+"' href='#'>",i+=""+u+"("+n+")",i+="</a>",i+="</li>",t("#words").append(i);return t(".js-word-link").click(function(n){var o,a,f;u=n.target.getAttribute("data-word"),t("#lyrics").empty();for(a=0,f=e.length;a<f;a++)s=e[a],s.lyric.indexOf(u)!==-1&&(o="/"+s.filename,i="",i+="<li>",i+="<a id='"+s.id+"' class='js-sound-link' href='"+o+"'>",i+=s.lyric,i+="</a>",i+="</li>",t("#lyrics").append(i),t(".js-sound-link").click(function(e){var t;return t=e.target.id,o=e.target.href,r.play(t,o),!1}));return!1})}),n.error(function(e,t,n){throw new Error("Error in WordLinks.init's getJSON: "+n)}),n},{init:n}})}.call(this),function(){define("cs!app/LyricsTableData",["require"],function(e){var t,n;return n=function(e){var t,r;if(e===null||typeof e!="object")return e;r=e.constructor();for(t in e)r[t]=n(e[t]);return r},t=function(){function e(){this._highlightY=0,this._rows=[]}return e.prototype.highlightY=function(){return this._highlightY},e.prototype.rows=function(){return n(this._rows)},e.prototype.highlightedRow=function(){return n(this._rows[this._highlightY])},e.prototype._convertStartTime=function(e){if(typeof e=="number")return e;if(e===null)return null;if(e==="")return null;if(typeof e=="string"&&e.match(/^[0-9]+$/))return parseInt(e);throw new Error("Invalid start_time argument: "+e+" "+typeof e)},e.prototype._convertLyric=function(e){if(typeof e=="string")return e;throw new Error("Invalid lyric argument: "+e)},e.prototype.loadLyricsLine=function(e,t){return e=this._convertStartTime(e),t=this._convertLyric(t),this._rows.push({start_time:e,lyric:t,skip:!1})},e.prototype.moveHighlight=function(e){if(e!==-1&&e!==1)throw new Error("Invalid argument "+e+" to moveHighlight: must be -1 or 1");this._highlightY+=e,this._highlightY<0&&(this._highlightY=0);if(this._highlightY>this._rows.length)return this._highlightY=this._rows.length},e.prototype.setStartTime=function(e){return e=this._convertStartTime(e),this._rows[this._highlightY].start_time=e},e.prototype.toggleSkipOnHighlightedRow=function(){return this._rows[this._highlightY].skip=!this._rows[this._highlightY].skip},e}()})}.call(this),function(){define("cs!app/LyricsTableView",["require","jquery","cs!app/LyricsTableData"],function(e){var t,n,r,i;return t=e("jquery"),n=e("cs!app/LyricsTableData"),i=function(e){var t,n,r;if(e.offsetParent){n=0,r=0,t=e;while(t)n+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return{x:n,y:r,w:e.offsetWidth,h:e.offsetHeight}}},r=function(){function e(e,t){this._player=e,this._data=t}return e.ARROW_KEY_UP=38,e.ARROW_KEY_DOWN=40,e.ENTER_KEY=13,e.S_KEY=83,e.ARROW_KEYS=[e.ARROW_KEY_UP,e.ARROW_KEY_DOWN],e.COL_NAME_TO_COL_NUM={start_time:0,skip:1,lyric:2},e.prototype.init=function(){var e=this;return t(document).keydown(function(t){return e.constructor.ARROW_KEYS.indexOf(t.which)!==-1?(t.preventDefault(),!1):!0}),t(document).keyup(function(t){switch(t.which){case e.constructor.ARROW_KEY_UP:return e._drawHighlight(!1),e._data.moveHighlight(-1),e._drawHighlight(!0),e._scrollToShowHighlight();case e.constructor.ARROW_KEY_DOWN:return e._drawHighlight(!1),e._data.moveHighlight(1),e._drawHighlight(!0),e._scrollToShowHighlight();case e.constructor.ENTER_KEY:return e._drawHighlight(!1),e._data.moveHighlight(1),e.fillInCurrentPosition(),e._drawHighlight(!0),e._scrollToShowHighlight();case e.constructor.S_KEY:return e.toggleSkip()}})},e.prototype.loadLyricsLine=function(e,n){var r;return this._data.loadLyricsLine(e,n),r="",r+="<tr>\n",r+="<td>"+e+"</td>\n",r+="<td></td>\n",r+="<td>"+n+"</td>\n",r+="</tr>\n",t("#js-lyrics-table > tbody").append(r)},e.prototype._highlightedRowSelector=function(){return"#js-lyrics-table tr:nth-child("+(this._data.highlightY()+1)+")"},e.prototype._dataSkipToHtml=function(e){return e?"#":""},e.prototype._highlightedRowForColSelector=function(e){},e.prototype._reloadHighlightedDataForCol=function(e){var n,r,i;return r=this._data.highlightedRow()[e],e==="skip"&&(r=this._dataSkipToHtml(r)),n=this.constructor.COL_NAME_TO_COL_NUM[e],i=""+this._highlightedRowSelector()+" td:nth-child("+(n+1)+")",t(i).html(r)},e.prototype.fillInCurrentPosition=function(){var e;return e=this._player.getPosition(),this._data.setStartTime(e),this._reloadHighlightedDataForCol("start_time")},e.prototype._drawHighlight=function(e){var n;return n=this._highlightedRowSelector(),e?t(n).addClass("selectedRow"):t(n).removeClass("selectedRow")},e.prototype._scrollToShowHighlight=function(){var e,n,r,s,o,u,a,f,l,c;n=this._highlightedRowSelector(),c=i(t(n)[0]),f=c.x,l=c.y,u=c.w,e=c.h,s=window.pageYOffset,l<s&&(t("body")[0].scrollTop=l),o=t(".scrollbar-measure")[0].offsetWidth-t(".scrollbar-measure")[0].clientWidth,a=window.innerHeight-o,r=window.pageYOffset+a;if(l+e>r)return t("body")[0].scrollTop=l+e-a},e.prototype.toggleSkip=function(){var e;return e=this._data.highlightedRow().skip,this._data.toggleSkipOnHighlightedRow(),this._reloadHighlightedDataForCol("skip")},e}()})}.call(this),function(){define("cs!app/LyricsLoader",["require","jquery"],function(e){var t,n;return t=e("jquery"),n=function(){function e(){}return e.prototype.load=function(e,n){var r=this;return t.ajax({url:"/media/lyrics_txt/"+e+".txt",success:function(e,t,i){var s,o,u,a,f;a=e.split("\n"),f=[];for(o=0,u=a.length;o<u;o++)s=a[o],f.push(r.interpretDataLine(s,n));return f},error:function(e,t,n){throw new Error("Error in LyricsLoader.load's ajax: "+n)}})},e.prototype.interpretDataLine=function(e,t){var n,r,i;return(r=e.match(/^([0-9]+)\s+(.*)$/))?(i=r[1],n=r[2]):(i="",n=e),t(i,n)},e}()})}.call(this),function(){define("cs!main2",["require","jquery","cs!app/fakeSoundManager","cs!app/soundManager","cs!app/Player","cs!app/WordLinks","cs!app/LyricsTableData","cs!app/LyricsTableView","cs!app/LyricsLoader"],function(e){var t,n,r,i,s,o,u,a,f,l;return t=e("jquery"),u=e("cs!app/fakeSoundManager"),f=e("cs!app/soundManager"),s=e("cs!app/Player"),o=e("cs!app/WordLinks"),r=e("cs!app/LyricsTableData"),i=e("cs!app/LyricsTableView"),n=e("cs!app/LyricsLoader"),a=function(){var e,t,n,r,i;r={},n=/([^&=]+)=([^&]*)/g,e=window.decodeURIComponent,i=window.location.search,i=i.match(/^\?/)?i.substring(1):i;while(t=n.exec(i))r[e(t[1])]=e(t[2]);return r},l=function(e,u,a){var f,l,c,h,p,d,v;return d=t.Deferred().resolve(),t("#words").length>0&&t("#lyrics").length>0&&(p=o.init(e),d=d.pipe(function(){return p})),t("#player").length&&(l="/media/whole_songs/"+e+".mp3",c=new s(t("#player"),t,u,l),v=t.Deferred(),u.onready(function(){return v.resolve()}),d=d.pipe(function(){return v}),t("#js-lyrics-table").length>0&&(f=new r,h=new i(c,f),h.init(),p=(new n).load(e,function(){return h.loadLyricsLine.apply(h,arguments)}),d=d.pipe(function(){return p}))),d.done(function(){return t("#throbber-background").hide(),t("#throbber-foreground").hide(),a()})},{setupFromRequestParams:function(){var e,t;return e=a(),t=e.song,t?l(t,f,function(){}):window.alert("Please specify a song parameter")},setupForTestingAndThen:function(e){var t,n,r;return t=a(),n="testing",r=function(){switch(t.soundManager){case"fakeSoundManager":return u;case"realSoundManager":return f;default:throw window.alert("You must specify a soundManager param"),new Error("You must specify a soundManager param")}}(),l(n,r,e)}}})}.call(this),define("main",["cs!main2"],function(e){})